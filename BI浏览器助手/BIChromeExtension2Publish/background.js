async function getPageType(e){return e.includes("activeTab=")&&/activeTab=[0-9a-f-]{36}/.test(e)?"report":/\/analysis\/own\/folder/.test(e)?"analysis_folder":/\/analysis\/own\/subject\/[0-9a-f]{32}\/report\/[0-9a-f]{32}/.test(e)?"analysis_subject_template":/\/subject\/page\/edit\/[0-9a-f]{32}\/report\/[0-9a-f]{32}/.test(e)?"subject_template_edit":/\/subject\/page\/edit\/[0-9a-f]{32}\/widget\/[0-9a-f]{32}/.test(e)?"subject_widget":/\/config\/folder/.test(e)?"config_folder":/\/config\/table/.test(e)?"config_table":e.includes("management")?"management":"none"}async function checkUrl(e){var t,a=await chrome.tabs.get(e);return!!a.url&&(t=await getPageType(a.url),chrome.storage.local.set({pageType:t,tabId:e}),a.url)&&a.url.startsWith("https://bi.cvte.com/")}async function updateAction(e){var t=await checkUrl(e);t?(chrome.action.enable(e),chrome.action.setIcon({tabId:e,path:{16:"icons/icon16.png",32:"icons/icon32.png",48:"icons/icon48.png"}})):(chrome.action.disable(e),chrome.action.setIcon({tabId:e,path:{16:"icons/icon16_disable.png",32:"icons/icon32_disable.png",48:"icons/icon48_disable.png"}})),chrome.sidePanel.setOptions({tabId:e,path:"template/sidepanel.html",enabled:t})}chrome.runtime.onInstalled.addListener(()=>{console.log("BI extension installed."),chrome.sidePanel.setOptions({enabled:!1})}),chrome.tabs.onUpdated.addListener(async(e,t,a)=>{a.url&&"complete"===t.status&&(await updateAction(e),t=await getPageType(a.url),chrome.runtime.sendMessage({type:"urlUpdated",pageType:t,tabId:e}))}),chrome.tabs.onActivated.addListener(async e=>{await updateAction(e.tabId)}),chrome.action.onClicked.addListener(async e=>{chrome.sidePanel&&chrome.sidePanel.open({tabId:e.id})}),chrome.runtime.onMessage.addListener((e,t,a)=>{if("getCookies"===e.action)return chrome.tabs.query({active:!0,currentWindow:!0},function(e){e=e[0].url;chrome.cookies.getAll({url:e},e=>{e=e.map(e=>e.name+"="+e.value).join("; ");a(""===e?{success:!1,cookies:e}:{success:!0,cookies:e})})}),!0});